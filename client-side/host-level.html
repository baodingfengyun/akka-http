<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>主机级别客户端 API &bull; Akka HTTP Unofficial Chinese</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Http: Modern, fast, asynchronous, streaming-first HTTP server and client."/>
<link rel="canonical" href="https://www.yangbajing.me/akka-http//client-side/host-level.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-6.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com/lightbend-platform" target="_blank">
<svg class="lightbend-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 372 80">
<title>Lightbend</title>
<g id="lightbend-reverse">
<path d="M1,59V76a3,3,0,0,0,3,3H88a3,3,0,0,0,3-3V59a167.38,167.38,0,0,1-45,6A167.38,167.38,0,0,1,1,59Z" fill="#fff" />
<path d="M88,1H4A3,3,0,0,0,1,4V53c14.57,4.2,29.65,7,45,7s30.43-2.8,45-7V4A3,3,0,0,0,88,1Z" fill="#fff" />
<g id="original_weight" data-name="original weight">
<path d="M107.2,20.08a2.14,2.14,0,1,1,4.27,0v32h13.6A2,2,0,0,1,127,54a1.94,1.94,0,0,1-1.94,2H109.31a2.15,2.15,0,0,1-2.11-2.16Z" fill="#fff" />
<path d="M135,19.32a2.47,2.47,0,0,1,4.91,0V20A2.47,2.47,0,0,1,135,20Zm.38,10.59a2.08,2.08,0,1,1,4.16,0V54.15a2,2,0,0,1-2.06,2.11,2.08,2.08,0,0,1-2.1-2.11Z" fill="#fff" />
<path d="M150.8,61.44a1.91,1.91,0,0,1-1.08-1.73,2,2,0,0,1,1.89-1.83,1.69,1.69,0,0,1,.92.27,17.63,17.63,0,0,0,9.88,3c6.15,0,10.15-3.4,10.15-9.93v-3.3c-2.43,3.24-5.83,5.89-11,5.89a12.9,12.9,0,0,1-13.12-13.07v-.11a13.21,13.21,0,0,1,24-7.56V29.91a2.07,2.07,0,0,1,2.06-2.11,2.11,2.11,0,0,1,2.1,2.11V51.13c0,4.32-1.29,7.61-3.56,9.88-2.49,2.48-6.21,3.73-10.64,3.73A21.87,21.87,0,0,1,150.8,61.44Zm21.87-20.73V40.6c0-5.72-5-9.45-10.26-9.45s-9.67,3.67-9.67,9.4v.1a9.45,9.45,0,0,0,9.67,9.51C167.7,50.16,172.67,46.32,172.67,40.71Z" fill="#fff" />
<path d="M186.22,18.41a2.08,2.08,0,1,1,4.16,0V32.93a10.57,10.57,0,0,1,9.56-5.45c6.75,0,10.69,4.53,10.69,11.18V54.15a2.08,2.08,0,1,1-4.16,0V39.68c0-5.18-2.81-8.42-7.72-8.42s-8.37,3.51-8.37,8.75V54.15a2,2,0,0,1-2,2.11,2.08,2.08,0,0,1-2.11-2.11Z" fill="#fff" />
<path d="M220.46,48.59V31.74h-2.27a1.89,1.89,0,0,1-1.84-1.83,1.86,1.86,0,0,1,1.84-1.84h2.27V21.48a2.06,2.06,0,0,1,2-2.1,2.14,2.14,0,0,1,2.1,2.1v6.59h7.24a1.91,1.91,0,0,1,1.89,1.84,1.86,1.86,0,0,1-1.89,1.83h-7.24V48.05c0,3.4,1.89,4.64,4.7,4.64a12,12,0,0,0,2.54-.37,1.8,1.8,0,0,1,1.78,1.78,1.73,1.73,0,0,1-1.19,1.62,10.57,10.57,0,0,1-4.1.75C223.86,56.47,220.46,54.26,220.46,48.59Z" fill="#fff" />
<path d="M242.65,18.41a2.08,2.08,0,1,1,4.16,0V33.69c2.27-3.35,5.56-6.21,10.69-6.21,6.7,0,13.34,5.29,13.34,14.47v.11c0,9.12-6.59,14.52-13.34,14.52a12.6,12.6,0,0,1-10.69-5.94v3.51a2.07,2.07,0,0,1-2.05,2.11,2.11,2.11,0,0,1-2.11-2.11Zm23.92,23.7V42c0-6.58-4.53-10.8-9.83-10.8A10.41,10.41,0,0,0,246.65,42v.11c0,6.48,4.91,10.8,10.09,10.8C262.14,52.86,266.57,48.86,266.57,42.11Z" fill="#fff" />
<path d="M290.17,56.64c-7.67,0-13.93-5.89-13.93-14.53V42c0-8,5.67-14.52,13.39-14.52,8.26,0,13,6.75,13,14.15a1.94,1.94,0,0,1-1.95,1.94H280.45c.59,6,4.86,9.45,9.83,9.45a11.4,11.4,0,0,0,8-3.24,1.83,1.83,0,0,1,1.19-.49,1.81,1.81,0,0,1,1.84,1.78,1.78,1.78,0,0,1-.65,1.35A14.2,14.2,0,0,1,290.17,56.64Zm8.26-16.15c-.43-5.07-3.35-9.5-8.91-9.5-4.86,0-8.53,4.05-9.07,9.5Z" fill="#fff" />
<path d="M309.5,29.91a2.08,2.08,0,1,1,4.16,0v3a10.57,10.57,0,0,1,9.56-5.45c6.75,0,10.69,4.53,10.69,11.18V54.15a2.08,2.08,0,1,1-4.16,0V39.68c0-5.18-2.81-8.42-7.72-8.42s-8.37,3.51-8.37,8.75V54.15a2,2,0,0,1-2.05,2.11,2.08,2.08,0,0,1-2.11-2.11Z" fill="#fff" />
<path d="M368.68,54.15a2.08,2.08,0,1,1-4.15,0V50.37c-2.27,3.35-5.57,6.21-10.7,6.21-6.69,0-13.33-5.29-13.33-14.47V42c0-9.12,6.64-14.52,13.33-14.52a12.61,12.61,0,0,1,10.7,5.94v-15a2,2,0,0,1,2.05-2.11,2.07,2.07,0,0,1,2.1,2.11ZM344.76,42v.11c0,6.58,4.59,10.8,9.83,10.8a10.43,10.43,0,0,0,10.1-10.8V42a10.38,10.38,0,0,0-10.1-10.75C349.19,31.2,344.76,35.2,344.76,42Z" fill="#fff" />
</g>
</g>
</svg>
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="See how Akka fits into Lightbend Platform [Button]" href="https://www.lightbend.com/akka-part-of-lightbend-platform" target="_blank">
<span>See how Akka fits into</span>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 274 80">
<title>Lightbend Platform</title>
<g id="lightbend-platform-reverse">
<g id="icon">
<path d="M1,59V76a3,3,0,0,0,3,3H88a3,3,0,0,0,3-3V59a167.38,167.38,0,0,1-45,6A167.38,167.38,0,0,1,1,59Z" fill="#fff" />
<path d="M88,1H4A3,3,0,0,0,1,4V53c14.57,4.2,29.65,7,45,7s30.43-2.8,45-7V4A3,3,0,0,0,88,1Z" fill="#fff" />
</g>
<g id="lightbend">
<path d="M104,14.73a1,1,0,1,1,2,0V29.4h6.24a.91.91,0,0,1,.89.92.88.88,0,0,1-.89.89H105a1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M116.77,14.39a1.14,1.14,0,0,1,2.26,0v.32a1.14,1.14,0,0,1-2.26,0Zm.18,4.85a1,1,0,1,1,1.9,0V30.37a.93.93,0,0,1-.94,1,1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M124,33.72a.89.89,0,0,1-.5-.8.91.91,0,0,1,.87-.84.8.8,0,0,1,.42.12,8.05,8.05,0,0,0,4.54,1.39C132.16,33.59,134,32,134,29V27.52a6,6,0,0,1-5,2.7,5.92,5.92,0,0,1-6-6v-.05a6.07,6.07,0,0,1,11-3.47V19.24a.94.94,0,0,1,.94-1,1,1,0,0,1,1,1V29a6.18,6.18,0,0,1-1.64,4.54,6.73,6.73,0,0,1-4.88,1.71A10,10,0,0,1,124,33.72Zm10-9.52v-.05a4.49,4.49,0,0,0-4.7-4.34,4.24,4.24,0,0,0-4.44,4.32v.05a4.34,4.34,0,0,0,4.44,4.36A4.52,4.52,0,0,0,134,24.2Z" fill="#fff" />
<path d="M140.26,14a1,1,0,1,1,1.91,0v6.66a4.84,4.84,0,0,1,4.39-2.5c3.1,0,4.9,2.08,4.9,5.13v7.11a1,1,0,1,1-1.9,0V23.73c0-2.38-1.29-3.87-3.55-3.87a3.77,3.77,0,0,0-3.84,4v6.49a.93.93,0,0,1-.94,1,1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M156,27.82V20.09h-1a.87.87,0,0,1-.84-.85.85.85,0,0,1,.84-.84h1v-3a1,1,0,0,1,.94-1,1,1,0,0,1,1,1v3h3.32a.87.87,0,0,1,.87.84.85.85,0,0,1-.87.85h-3.32v7.48A1.9,1.9,0,0,0,160,29.7a5.31,5.31,0,0,0,1.16-.17.82.82,0,0,1,.82.82.79.79,0,0,1-.54.74,4.9,4.9,0,0,1-1.89.35A3.26,3.26,0,0,1,156,27.82Z" fill="#fff" />
<path d="M166.16,14a1,1,0,1,1,1.91,0v7A5.75,5.75,0,0,1,173,18.13c3.07,0,6.12,2.43,6.12,6.64v.05c0,4.19-3,6.67-6.12,6.67a5.78,5.78,0,0,1-4.91-2.73v1.61a1,1,0,0,1-.94,1,1,1,0,0,1-1-1Zm11,10.88V24.8c0-3-2.08-5-4.51-5A4.78,4.78,0,0,0,168,24.77v.05a4.78,4.78,0,0,0,4.64,5C175.11,29.78,177.14,27.94,177.14,24.85Z" fill="#fff" />
<path d="M188,31.51a6.37,6.37,0,0,1-6.4-6.66V24.8c0-3.7,2.61-6.67,6.15-6.67,3.79,0,5.95,3.1,5.95,6.49a.89.89,0,0,1-.89.89h-9.27A4.47,4.47,0,0,0,188,29.85a5.23,5.23,0,0,0,3.69-1.49.85.85,0,0,1,.54-.22.81.81,0,0,1,.55,1.44A6.52,6.52,0,0,1,188,31.51Zm3.79-7.41c-.2-2.33-1.54-4.36-4.09-4.36-2.23,0-3.91,1.86-4.16,4.36Z" fill="#fff" />
<path d="M196.84,19.24a1,1,0,1,1,1.91,0v1.39a4.84,4.84,0,0,1,4.38-2.5c3.1,0,4.91,2.08,4.91,5.13v7.11a1,1,0,1,1-1.91,0V23.73c0-2.38-1.29-3.87-3.54-3.87a3.77,3.77,0,0,0-3.84,4v6.49a.93.93,0,0,1-.94,1,1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M224,30.37a1,1,0,1,1-1.91,0V28.64a5.77,5.77,0,0,1-4.9,2.85,6.25,6.25,0,0,1-6.13-6.64V24.8a6.29,6.29,0,0,1,6.13-6.67,5.78,5.78,0,0,1,4.9,2.73V14a.93.93,0,0,1,.94-1,1,1,0,0,1,1,1Zm-11-5.6v.05a4.64,4.64,0,0,0,4.51,5,4.79,4.79,0,0,0,4.64-5v-.05a4.76,4.76,0,0,0-4.64-4.93C215.05,19.84,213,21.67,213,24.77Z" fill="#fff" />
</g>
<path d="M103.36,41H114.8c6.68,0,10.72,4,10.72,9.68v.08c0,6.48-5,9.84-11.32,9.84h-4.68V69h-6.16Zm11,14.12c3.08,0,4.88-1.84,4.88-4.24V50.8c0-2.76-1.92-4.24-5-4.24h-4.76v8.56Z" fill="#fff" />
<path d="M128.89,39.8H135V69h-6.08Z" fill="#fff" />
<path d="M138.75,62.84v-.08c0-4.68,3.56-6.84,8.64-6.84a15.23,15.23,0,0,1,5.24.88v-.36c0-2.52-1.56-3.92-4.6-3.92a15.77,15.77,0,0,0-5.92,1.16L140.59,49a18.92,18.92,0,0,1,8.32-1.72c3.32,0,5.72.88,7.24,2.4s2.32,4,2.32,6.84V69h-5.88V66.68a8.24,8.24,0,0,1-6.48,2.72C142.07,69.4,138.75,67.08,138.75,62.84Zm14-1.4V60.36a9.43,9.43,0,0,0-3.88-.8c-2.6,0-4.2,1-4.2,3v.08c0,1.64,1.36,2.6,3.32,2.6C150.79,65.2,152.71,63.64,152.71,61.44Z" fill="#fff" />
<path d="M164,62.92V52.76h-2.56v-5.2H164V42.08h6.08v5.48h5v5.2h-5v9.16c0,1.4.6,2.08,2,2.08a6.18,6.18,0,0,0,3-.76v4.88a9,9,0,0,1-4.8,1.24C166.51,69.36,164,67.88,164,62.92Z" fill="#fff" />
<path d="M180.43,52.76h-2.52v-5h2.52V46.4a7,7,0,0,1,1.72-5.19,6.63,6.63,0,0,1,4.92-1.68,13.5,13.5,0,0,1,4.32.59v5a7.7,7.7,0,0,0-2.76-.52c-1.4,0-2.2.72-2.2,2.32v.84h4.92v5h-4.84V69h-6.08Z" fill="#fff" />
<path d="M192.84,58.4v-.08c0-6.16,5-11.16,11.64-11.16S216,52.08,216,58.24v.08c0,6.16-5,11.16-11.64,11.16S192.84,64.56,192.84,58.4Zm17.2,0v-.08a5.7,5.7,0,0,0-5.64-5.92c-3.48,0-5.56,2.68-5.56,5.84v.08a5.7,5.7,0,0,0,5.64,5.92C208,64.24,210,61.56,210,58.4Z" fill="#fff" />
<path d="M219.89,47.56H226v4.32c1.24-3,3.24-4.88,6.84-4.72v6.36h-.32c-4,0-6.52,2.44-6.52,7.56V69h-6.08Z" fill="#fff" />
<path d="M235.8,47.56h6.08v3a7.66,7.66,0,0,1,6.32-3.44,6.42,6.42,0,0,1,6,3.4,8.83,8.83,0,0,1,7-3.4c4.52,0,7.24,2.72,7.24,7.88V69h-6.08V57c0-2.88-1.28-4.36-3.56-4.36S255.2,54.16,255.2,57V69h-6.08V57c0-2.88-1.28-4.36-3.56-4.36s-3.68,1.48-3.68,4.36V69H235.8Z" fill="#fff" />
</g>
</svg>
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 752 192">
<title>Lagom Framework</title>
<g>
<g id="Lagom">
<path d="M291.58,31.79h19.83v87.92c0,8.1,2.65,11.57,9.92,11.57a21.37,21.37,0,0,0,5.95-.66V148.3a35.73,35.73,0,0,1-9.42,1c-17.52,0-26.28-8.92-26.28-26.94Z" fill="#652b7c" />
<path d="M398.34,75.75V63.69h19.83v58.17c0,7.1,1.65,9.75,6.11,9.75,1.16,0,2.64-.17,4.13-.33v16a28.83,28.83,0,0,1-9.75,1.32c-4.79,0-8.59-.83-11.57-2.65a15.32,15.32,0,0,1-6.77-10.08C394.53,144.66,385,149,371.73,149A39.59,39.59,0,0,1,342,136.4c-7.93-8.43-11.89-18.67-11.89-31.07s4-22.64,11.89-30.9a39.59,39.59,0,0,1,29.75-12.56C385.12,61.87,395.2,67.82,398.34,75.75Zm-5.95,47.76a24.32,24.32,0,0,0,7.43-18.18,24.34,24.34,0,0,0-7.43-18.18,24.71,24.71,0,0,0-18-7.27,23.94,23.94,0,0,0-17.68,7.27c-4.63,4.8-6.94,10.91-6.94,18.18s2.31,13.39,6.94,18.18a23.94,23.94,0,0,0,17.68,7.27A24.71,24.71,0,0,0,392.39,123.51Z" fill="#652b7c" />
<path d="M495.67,63.69H515.5v69.4c0,20-2.81,32.23-14.05,41-7.93,6.11-17.68,9.25-29.41,9.25-15.54,0-28.92-4-40.32-12.06l9.58-14.71a50.5,50.5,0,0,0,28.59,9.09q11.66,0,18.34-5c5.29-3.8,7.94-10.91,7.94-21.15v-4.13c-4,7.1-13.89,12.23-27.11,12.23a40.51,40.51,0,0,1-29.74-12.23c-7.93-8.1-11.9-18.35-11.9-30.41s4-22.31,12.06-30.57a39.23,39.23,0,0,1,29.58-12.56c13.72,0,23.8,5.78,26.61,13.88ZM489.72,123a24.16,24.16,0,0,0,7.44-18,23.84,23.84,0,0,0-7.44-17.85,24.69,24.69,0,0,0-18-7.27A23.92,23.92,0,0,0,454,87.15,24.7,24.7,0,0,0,447.09,105,25,25,0,0,0,454,123a23.75,23.75,0,0,0,17.68,7.11C478.81,130.12,484.93,127.81,489.72,123Z" fill="#652b7c" />
<path d="M522.44,105.33a42.06,42.06,0,0,1,13.22-31.4c8.76-8.43,19.5-12.72,32.22-12.72s23.47,4.29,32.23,12.72a42.06,42.06,0,0,1,13.22,31.4,42,42,0,0,1-13.22,31.4c-8.76,8.43-19.5,12.72-32.23,12.72s-23.46-4.29-32.22-12.72A42,42,0,0,1,522.44,105.33ZM586.23,124a25.68,25.68,0,0,0,7.43-18.68,25,25,0,0,0-7.43-18.51,26.13,26.13,0,0,0-36.85,0,25.58,25.58,0,0,0-7.27,18.51A26.25,26.25,0,0,0,549.38,124a26.56,26.56,0,0,0,36.85,0Z" fill="#652b7c" />
<path d="M620.6,147V63.69h19.67v11.9C643.74,67.49,652,62,662.58,62,674,62,681.91,66.83,686,76.58,690.84,66.83,699.76,62,712.81,62c18,0,28.43,12.72,28.43,33.38v26.27c0,6.45,1.15,8.76,5.62,8.76a15,15,0,0,0,2.81-.33v16.69a28.48,28.48,0,0,1-8.6,1c-13.05,0-19.5-7.27-19.5-21.81V98.23c0-11.41-5.28-18.51-14.54-18.51s-16,8.09-16,19.33V147H671.34V98.23c0-11.41-5.46-18.51-14.88-18.51-9.25,0-16.19,8.09-16.19,19.33V147Z" fill="#652b7c" />
</g>
<g id="Icon">
<path d="M261,84l-70,34,70,34S260.78,84.27,261,84Z" fill="#652b7c" />
<polygon points="121 152 191 118 121 84 121 152" fill="#652b7c" />
<path d="M191,118l70,34c-.27,0-41.76,25-60.63,36.24a17.63,17.63,0,0,1-18,0C163.47,177,121,152,121,152Z" fill="#421540" />
<path d="M200.23,47.65C219.09,58.88,261,84,261,84l-70,34L121,84c.27,0,42.31-25.12,61.18-36.36A17.67,17.67,0,0,1,200.23,47.65Z" fill="#bf97c6" />
<path d="M145,20.58l-35,17,35,17S144.89,20.72,145,20.58Z" fill="#652b7c" />
<polygon points="75 54.58 110 37.58 75 20.58 75 54.58" fill="#652b7c" />
<path d="M110,37.58l35,17c-.14,0-20.88,12.5-30.31,18.12a8.81,8.81,0,0,1-9,0C96.23,67.08,75,54.58,75,54.58Z" fill="#421540" />
<path d="M114.61,2.4C124,8,145,20.58,145,20.58l-35,17-35-17c.14,0,21.16-12.56,30.59-18.18A8.84,8.84,0,0,1,114.61,2.4Z" fill="#bf97c6" />
<path d="M101,91,51,115.54l50,24.53S100.84,91.21,101,91Z" fill="#652b7c" />
<polygon points="1 140.07 51 115.54 1 91.02 1 140.07" fill="#652b7c" />
<path d="M51,115.54l50,24.53c-.19,0-29.83,18-43.3,26.14a12.48,12.48,0,0,1-12.89,0C31.34,158.1,1,140.07,1,140.07Z" fill="#421540" />
<path d="M57.59,64.79C71.06,72.9,101,91,101,91L51,115.54,1,91c.19,0,30.22-18.12,43.7-26.23A12.48,12.48,0,0,1,57.59,64.79Z" fill="#bf97c6" />
</g>
</g>
</svg>
<span>Opinionated Microservices Framework</span>
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 517 270">
<title>Play Framework</title>
<path d="M36.92,26.44l6.19-6.16a23,23,0,0,1,33.68,1.3l85.77,100a23,23,0,0,1-.22,30.17l-85.5,96.91a23,23,0,0,1-33.49,1.05l-6.17-6.17a23,23,0,0,1-1.4-31l51.16-61.39a23,23,0,0,0,.29-29.08l-52-65A23,23,0,0,1,36.92,26.44Z" fill="#92d13d" />
<path d="M86.94,151.18,35.78,212.57a23,23,0,0,0,1.4,31l6.17,6.17a23,23,0,0,0,33.49-1.05l18.51-21a101.68,101.68,0,0,0,10.89-45.91A101.62,101.62,0,0,0,90,126.54,23,23,0,0,1,86.94,151.18Z" fill="#49691f" />
<path d="M206.64,209.51H186.72V93.81h19.92v12.12c2.82-8.13,13-13.94,26.72-13.94,11.79,0,21.75,4.15,29.72,12.61,8.13,8.3,12.12,18.59,12.12,31s-4,22.75-12.12,31.21c-8,8.3-17.93,12.45-29.72,12.45-13.77,0-23.9-5.81-26.72-13.94Zm5.81-92.13a26.46,26.46,0,0,0,0,36.52,25.42,25.42,0,0,0,18.26,7.31,23.36,23.36,0,0,0,17.59-7.31c4.82-4.81,7.14-11,7.14-18.26s-2.32-13.44-7.14-18.26a23.39,23.39,0,0,0-17.59-7.3A25.46,25.46,0,0,0,212.45,117.38Z" fill="#49691f" />
<path d="M282,61.77h19.92v88.32c0,8.13,2.66,11.62,10,11.62a21.11,21.11,0,0,0,6-.67V178.8a35.53,35.53,0,0,1-9.46,1c-17.6,0-26.4-9-26.4-27.06Z" fill="#49691f" />
<path d="M385.25,105.93V93.81h19.92v58.43c0,7.14,1.66,9.8,6.14,9.8,1.17,0,2.66-.17,4.16-.33v16.1a28.82,28.82,0,0,1-9.8,1.33c-4.81,0-8.63-.83-11.62-2.66a15.41,15.41,0,0,1-6.81-10.13c-5.8,8.8-15.43,13.12-28.71,13.12a39.74,39.74,0,0,1-29.88-12.62c-8-8.46-12-18.76-12-31.21s4-22.74,12-31A39.77,39.77,0,0,1,358.53,92C372,92,382.1,98,385.25,105.93Zm-6,48a24.39,24.39,0,0,0,7.47-18.26,24.42,24.42,0,0,0-7.47-18.26,24.82,24.82,0,0,0-18.1-7.3,24.05,24.05,0,0,0-17.76,7.3c-4.65,4.82-7,11-7,18.26s2.32,13.45,7,18.26a24,24,0,0,0,17.76,7.31A24.79,24.79,0,0,0,379.28,153.9Z" fill="#49691f" />
<path d="M422.36,194.24a29.76,29.76,0,0,0,9.29,1.33,13.13,13.13,0,0,0,7.31-1.83c1.82-1.16,3.48-3.65,4.81-7.13l2.16-6-35-86.82H431l24.57,63.08,23.07-63.08h20.09L461.2,191.09q-3.74,9.71-9,14.94c-5,4.65-11.62,7-20.09,7a34.91,34.91,0,0,1-9.79-1.33Z" fill="#49691f" />
</svg>
<span>High velocity<br> web framework</span>
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 590 270">
<title>Scala</title>
<path d="M200.7,142.39c6,11.79,15.6,17.6,29.05,17.6,14.44,0,19.59-7.64,19.59-15.11,0-5.15-1.83-8.63-6.64-11.79-4.82-3.32-8.3-4.81-16.93-8-10.63-4-16.77-7-23.41-12.29-6.64-5.48-9.79-13-9.79-22.74a28.28,28.28,0,0,1,10.29-22.58c7-5.81,15.44-8.63,25.56-8.63,15.77,0,27.72,6.31,35.69,18.76L249.34,87.78c-4.48-6.81-11.29-10.3-20.59-10.3-9.13,0-15.77,5.15-15.77,12.29,0,4.81,2,7.14,4.82,10,1.82,1.33,6.47,3.32,8.63,4.48l6,2.32,6.8,2.66c11,4.48,18.76,9.3,23.57,14.44s7.31,12.12,7.31,20.75c0,20.42-14.11,34.2-40.51,34.2-21.41,0-37.18-10-44.48-26.4Z" fill="#380d09" />
<path d="M354.25,104.71,342,117.49a28.14,28.14,0,0,0-21.24-9.13,25,25,0,0,0-18.43,7.47,27.76,27.76,0,0,0,0,37.52,25,25,0,0,0,18.43,7.47A28.14,28.14,0,0,0,342,151.69l12.29,12.78c-9,9.63-20.09,14.44-33.53,14.44-12.79,0-23.58-4.15-32.37-12.62s-13.12-19.09-13.12-31.7,4.32-23.08,13.12-31.54,19.58-12.78,32.37-12.78C334.16,90.27,345.28,95.08,354.25,104.71Z" fill="#380d09" />
<path d="M393.88,125.62C408,124.3,413,122.47,413,116c0-5.15-4.64-9.13-13.94-9.13q-13.44,0-22.41,10.95l-12.28-10.46c8.13-11.45,19.58-17.09,34.36-17.09,20.75,0,33.7,10,33.7,27.05v37c0,5.81,2.15,6.48,7,6.48h.5v15.43c-2,1.17-5.15,1.83-9.3,1.83-4.48,0-8-1.33-10.62-4a14.06,14.06,0,0,1-3-5.48c-5.81,6.8-15.27,10.29-28.39,10.29-18.42,0-30.87-10.13-30.87-25.4C357.7,136.41,369.15,127.78,393.88,125.62ZM391.56,162c13.28,0,21.41-6,21.41-16.6v-9.3a9.75,9.75,0,0,1-4.14,2.49c-3.82,1.33-6.31,1.66-14.28,2.49-11.62,1.33-17.43,5-17.43,10.79C377.12,158.33,382.43,162,391.56,162Z" fill="#380d09" />
<path d="M444.84,60.88h19.92V149.2c0,8.13,2.66,11.62,10,11.62a21.15,21.15,0,0,0,6-.67v17.76a35.56,35.56,0,0,1-9.47,1c-17.59,0-26.39-9-26.39-27.06Z" fill="#380d09" />
<path d="M521.71,125.62c14.11-1.32,19.09-3.15,19.09-9.62,0-5.15-4.64-9.13-13.94-9.13q-13.44,0-22.41,10.95l-12.28-10.46c8.13-11.45,19.58-17.09,34.36-17.09,20.75,0,33.7,10,33.7,27.05v37c0,5.81,2.15,6.48,7,6.48h.5v15.43c-2,1.17-5.15,1.83-9.3,1.83-4.48,0-8-1.33-10.62-4a13.94,13.94,0,0,1-3-5.48c-5.81,6.8-15.27,10.29-28.39,10.29-18.42,0-30.87-10.13-30.87-25.4C485.53,136.41,497,127.78,521.71,125.62ZM519.39,162c13.28,0,21.41-6,21.41-16.6v-9.3a9.73,9.73,0,0,1-4.15,2.49c-3.81,1.33-6.3,1.66-14.27,2.49-11.62,1.33-17.43,5-17.43,10.79C505,158.33,510.26,162,519.39,162Z" fill="#380d09" />
<path d="M30.55,94.83C32.4,97.38,48,102.19,71.27,107.2c23.27,4.46,47.47,22.07,66.29,16.64,12.73-3.68,26.54-36.47,26.54-41.34V82c0-3.4-2.55-6.13-6.88-8.4-17.75-9.07-21.11-12.41-27.69-10.6C95.37,72.43,35.06,67.61,30.55,94.83Z" fill="#380d09" fill-rule="evenodd" />
<path d="M30.55,161.41C32.4,164,48,168.77,71.27,173.79c26,4.74,48.61,20.19,67.44,14.75,12.73-3.68,25.39-34.58,25.39-39.46v-.48c0-3.39-2.55-6.13-6.88-8.39-13.54-7.2-31.43-15.13-38-13.32C85,136.3,39.26,138.37,30.55,161.41Z" fill="#380d09" fill-rule="evenodd" />
<path d="M30.36,109.14v.48h0A3.73,3.73,0,0,1,30.36,109.14Z" fill="#555" fill-rule="evenodd" />
<path d="M138.66,28.78C107.2,37.87,57.29,43,30.4,43h0V94.35a.8.8,0,0,0,.19.48c18.35,0,75-6,109.18-15.4a129,129,0,0,0,17.49-5.81c4.18-1.88,6.88-3.86,6.88-5.92V15.91C164.1,20.79,151.39,25.11,138.66,28.78Z" fill="#de3423" fill-rule="evenodd" />
<path d="M138.66,95.37c-18.83,5.43-44.24,9.47-67.39,11.83-15.54,1.59-30.06,2.42-40.87,2.42h0v51.31a.8.8,0,0,0,.19.48c18.35,0,75-6,109.18-15.39a130.38,130.38,0,0,0,17.49-5.81c4.18-1.89,6.88-3.86,6.88-5.92V82.5C164.1,87.37,151.39,91.69,138.66,95.37Z" fill="#de3423" fill-rule="evenodd" />
<path d="M138.66,162c-18.83,5.43-44.24,9.46-67.39,11.83-15.56,1.59-30.1,2.42-40.91,2.42V228c18.16,0,75.1-5.95,109.37-15.39,12.63-3.48,24.37-7.44,24.37-11.74V149.08C164.1,154,151.39,158.28,138.66,162Z" fill="#de3423" fill-rule="evenodd" />
</svg>
<span>The JVM language<br> of pragmatism</span>
</a>
<div class="akka">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 658 270">
<title>Akka</title>
<g id="akka-full-color">
<path d="M349.64,105.46V93.34h19.92v58.44c0,7.13,1.66,9.79,6.14,9.79,1.17,0,2.66-.17,4.15-.33v16.1a28.71,28.71,0,0,1-9.79,1.33c-4.81,0-8.63-.83-11.62-2.66a15.41,15.41,0,0,1-6.81-10.12C345.82,174.68,336.2,179,322.92,179A39.74,39.74,0,0,1,293,166.38c-8-8.46-12-18.75-12-31.2s4-22.75,12-31.05a39.77,39.77,0,0,1,29.88-12.61C336.36,91.52,346.49,97.49,349.64,105.46Zm-6,48a24.42,24.42,0,0,0,7.47-18.26,24.39,24.39,0,0,0-7.47-18.26,24.79,24.79,0,0,0-18.1-7.31,24,24,0,0,0-17.76,7.31c-4.65,4.81-7,11-7,18.26s2.32,13.44,7,18.26a24,24,0,0,0,17.76,7.3A24.82,24.82,0,0,0,343.67,153.44Z" fill="#0b5567" />
<path d="M388.48,177V61.31h19.76v67.56l30.87-35.53H462l-32.7,37.35L465.51,177H442.93l-26.39-33.7-8.3,9.3V177Z" fill="#0b5567" />
<path d="M470.82,177V61.31h19.75v67.56l30.88-35.53h22.91l-32.7,37.35L547.84,177H525.27l-26.4-33.7-8.3,9.3V177Z" fill="#0b5567" />
<path d="M607.87,105.46V93.34h19.92v58.44c0,7.13,1.66,9.79,6.14,9.79,1.17,0,2.66-.17,4.15-.33v16.1a28.71,28.71,0,0,1-9.79,1.33c-4.81,0-8.63-.83-11.62-2.66a15.41,15.41,0,0,1-6.81-10.12c-5.81,8.79-15.43,13.11-28.71,13.11a39.74,39.74,0,0,1-29.88-12.62c-8-8.46-12-18.75-12-31.2s4-22.75,12-31.05a39.77,39.77,0,0,1,29.88-12.61C594.59,91.52,604.72,97.49,607.87,105.46Zm-6,48a24.42,24.42,0,0,0,7.47-18.26,24.39,24.39,0,0,0-7.47-18.26,24.79,24.79,0,0,0-18.1-7.31A24,24,0,0,0,566,116.92c-4.65,4.81-7,11-7,18.26s2.32,13.44,7,18.26a24,24,0,0,0,17.76,7.3A24.82,24.82,0,0,0,601.9,153.44Z" fill="#0b5567" />
<path d="M230.26,212.82c35.88,28.67,58.91-57,1.74-72.82-48-13.29-96.33,9.5-144.66,62.74C87.34,202.74,176.67,170,230.26,212.82Z" fill="#0b5567" />
<path d="M88.08,202c34.41-35.69,91.64-75.53,144.9-60.75A46.09,46.09,0,0,1,259.9,160.6L209.48,58.78c-7.2-11.46-25.58-9.15-35.95-.26L40.29,170.07a27.4,27.4,0,0,0-1.56,40.15l0,0a27.4,27.4,0,0,0,36.51,2L88.14,202Z" fill="#15a9ce" />
</g>
</svg>
<span>Actor-based,<br> cloud native toolkit</span>
</div>
<div class="platform">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Lightbend Platform.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="See Akka In Lightbend Platform [Button]" href="https://www.lightbend.com/akka-part-of-lightbend-platform" target="_blank">See Akka In Lightbend Platform</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>
</div>
</div>
</div>
</div>
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka HTTP Unofficial Chinese</a></h1>
</div>
<div class="nav-header-version">
Version 10.1.11
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security.html" class="page">! 安全声明 !</a></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. 导读</a></li>
  <li><a href="../usage.html" class="page">2. 使用</a></li>
  <li><a href="../common/index.html" class="page">3. 数据类型 &amp; 抽像</a></li>
  <li><a href="../server-side/index.html" class="page">4. 服务器 API</a></li>
  <li><a href="../client-side/index.html" class="page">5. 客户端 API</a>
  <ul>
    <li><a href="../client-side/request-and-response.html" class="page">HttpRequest 和 HttpResponse</a></li>
    <li><a href="../client-side/request-level.html" class="page">请求级别客户端 API</a></li>
    <li><a href="../client-side/host-level.html#主机级别客户端-api" class="active page">主机级别客户端 API</a>
    <ul>
      <li><a href="../client-side/host-level.html#requesting-a-host-connection-pool" class="header">Requesting a Host Connection Pool</a></li>
      <li><a href="../client-side/host-level.html#configuring-a-host-connection-pool" class="header">Configuring a Host Connection Pool</a></li>
      <li><a href="../client-side/host-level.html#using-a-host-connection-pool" class="header">Using a Host Connection Pool</a></li>
      <li><a href="../client-side/host-level.html#连接分配逻辑" class="header">连接分配逻辑</a></li>
      <li><a href="../client-side/host-level.html#retrying-a-request" class="header">Retrying a Request</a></li>
      <li><a href="../client-side/host-level.html#pool-shutdown" class="header">Pool Shutdown</a></li>
      <li><a href="../client-side/host-level.html#examples" class="header">Examples</a></li>
    </ul></li>
    <li><a href="../client-side/connection-level.html" class="page">连接级别客户端 API</a></li>
    <li><a href="../client-side/pool-overflow.html" class="page">池溢出和最大打开请求数设置</a></li>
    <li><a href="../client-side/client-https-support.html" class="page">客户端 HTTPS 支持</a></li>
    <li><a href="../client-side/client-transport.html" class="page">可插拔的客户端传输 / HTTP(S) 代理支持</a></li>
    <li><a href="../client-side/websocket-support.html" class="page">客户端 WebSocket 支持</a></li>
  </ul></li>
  <li><a href="../extensions.html" class="page">6. 扩展</a></li>
  <li><a href="../technologies.html" class="page">7. 支持的技术</a></li>
  <li><a href="../tipsandtricks.html" class="page">8. 提示和技巧</a></li>
  <li><a href="../contributing.html" class="page">9. 进行贡献</a></li>
  <li><a href="../reference.html" class="page">10. 参考</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka HTTP Unofficial Chinese</a></h1>
</div>
<div class="nav-header-version">
Version 10.1.11
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security.html" class="page">! 安全声明 !</a></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. 导读</a></li>
  <li><a href="../usage.html" class="page">2. 使用</a></li>
  <li><a href="../common/index.html" class="page">3. 数据类型 &amp; 抽像</a></li>
  <li><a href="../server-side/index.html" class="page">4. 服务器 API</a></li>
  <li><a href="../client-side/index.html" class="page">5. 客户端 API</a>
  <ul>
    <li><a href="../client-side/request-and-response.html" class="page">HttpRequest 和 HttpResponse</a></li>
    <li><a href="../client-side/request-level.html" class="page">请求级别客户端 API</a></li>
    <li><a href="../client-side/host-level.html#主机级别客户端-api" class="active page">主机级别客户端 API</a>
    <ul>
      <li><a href="../client-side/host-level.html#requesting-a-host-connection-pool" class="header">Requesting a Host Connection Pool</a></li>
      <li><a href="../client-side/host-level.html#configuring-a-host-connection-pool" class="header">Configuring a Host Connection Pool</a></li>
      <li><a href="../client-side/host-level.html#using-a-host-connection-pool" class="header">Using a Host Connection Pool</a></li>
      <li><a href="../client-side/host-level.html#连接分配逻辑" class="header">连接分配逻辑</a></li>
      <li><a href="../client-side/host-level.html#retrying-a-request" class="header">Retrying a Request</a></li>
      <li><a href="../client-side/host-level.html#pool-shutdown" class="header">Pool Shutdown</a></li>
      <li><a href="../client-side/host-level.html#examples" class="header">Examples</a></li>
    </ul></li>
    <li><a href="../client-side/connection-level.html" class="page">连接级别客户端 API</a></li>
    <li><a href="../client-side/pool-overflow.html" class="page">池溢出和最大打开请求数设置</a></li>
    <li><a href="../client-side/client-https-support.html" class="page">客户端 HTTPS 支持</a></li>
    <li><a href="../client-side/client-transport.html" class="page">可插拔的客户端传输 / HTTP(S) 代理支持</a></li>
    <li><a href="../client-side/websocket-support.html" class="page">客户端 WebSocket 支持</a></li>
  </ul></li>
  <li><a href="../extensions.html" class="page">6. 扩展</a></li>
  <li><a href="../technologies.html" class="page">7. 支持的技术</a></li>
  <li><a href="../tipsandtricks.html" class="page">8. 提示和技巧</a></li>
  <li><a href="../contributing.html" class="page">9. 进行贡献</a></li>
  <li><a href="../reference.html" class="page">10. 参考</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#主机级别客户端-api" name="主机级别客户端-api" class="anchor"><span class="anchor-link"></span></a>主机级别客户端 API</h1>
<p><em>Host-Level Client-Side API</em></p>
<p>As opposed to the <a href="connection-level.html">Connection-Level Client-Side API</a> the host-level API relieves you from manually managing individual HTTP connections. It autonomously manages a configurable pool of connections to <em>one particular target endpoint</em> (i.e. host/port combination).</p>
<p>与 <a href="connection-level.html">连接级别客户端 API</a> 相反，主机级别的 API 使你不必手动管理单个 HTTP 连接。 它自主管理连接到 <em>一个特定目标端点</em> （例如：主机/端口 组合）的可配置池。</p><div class="callout note "><div class="callout-title">Note</div>
<p>It is recommended to first read the <a href="../implications-of-streaming-http-entity.html">Implications of the streaming nature of Request/Response Entities</a> section, as it explains the underlying full-stack streaming concepts, which may be unexpected when coming from a background with non-&ldquo;streaming first&rdquo; HTTP Clients.</p>
<p>推荐阅读 <a href="../implications-of-streaming-http-entity.html">请求/响应实体流的实质含义</a> 部分，它阐明了（Akka HTTP）底层的全栈流的概念。 因为对于没有“流式优先” HTTP 客户端概念背景的人来说，也许会感到难以理解。</p></div>
<h2><a href="#requesting-a-host-connection-pool" name="requesting-a-host-connection-pool" class="anchor"><span class="anchor-link"></span></a>Requesting a Host Connection Pool</h2>
<p><strong>请求主机连接池</strong></p>
<p>The best way to get a hold of a connection pool to a given target endpoint is the <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> method, which returns a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> that can be &ldquo;baked&rdquo; into an application-level stream setup. This flow is also called a &ldquo;pool client flow&rdquo;.</p>
<p>获得一个持有到指定目标端点的连接池的最好方式是使用 <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> 方法，该方法返回一个可以“烘焙到”应用程序级别流设置中的 <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> 。 这个 flow 也被称为“池客户端 flow”。</p>
<p>The connection pool underlying a pool client flow is cached. For every <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span>, target endpoint and pool configuration there will never be more than a single pool live at any time.</p>
<p>构成连接池的池客户端 flow 被缓存。对于每个 <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span>，目标端点和池配置任何时候都不会有超过一个池活动。</p>
<p>Also, the HTTP layer transparently manages idle shutdown and restarting of connection pools as configured. The client flow instances therefore remain valid throughout the lifetime of the application, i.e. they can be materialized as often as required and the time between individual materialization is of no importance.</p>
<p>而且，HTTP 层按配置透明地管理连接池的空闲关闭和重启。</p>
<p>When you request a pool client flow with <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span>, Akka HTTP will immediately start the pool, even before the first client flow materialization. However, this running pool will not actually open the first connection to the target endpoint until the first request has arrived.</p>
<p>当你使用 <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> 请求“池客户端 flow”时，Akka HTTP 将立即启动池，甚至在第一个客户端 flow 具体化之前。 但是，在第一个请求到达前，该运行池实际上不会打开到目标端点的第一个连接。</p>
<h2><a href="#configuring-a-host-connection-pool" name="configuring-a-host-connection-pool" class="anchor"><span class="anchor-link"></span></a>Configuring a Host Connection Pool</h2>
<p><strong>配置主机连接池</strong></p>
<p>Apart from the connection-level config settings and socket options there are a number of settings that allow you to influence the behavior of the connection pool logic itself. Check out the <code>akka.http.host-connection-pool</code> section of the Akka HTTP <a href="../configuration.html">Configuration</a> for more information about which settings are available and what they mean.</p>
<p>除了连接级别配置设置和套接字选项之外，还有许多设置允许你影响连接池逻辑自身的行为。 有关哪些设置可用和它们的含义的更多信息，查看 Akka HTTP <a href="../configuration.html">配置</a> 的 <code>akka.http.host-connection-pool</code> 部分。</p>
<p>Note that, if you request pools with different configurations for the same target host you will get <em>independent</em> pools. This means that, in total, your application might open more concurrent HTTP connections to the target endpoint than any of the individual pool&rsquo;s <code>max-connections</code> settings allow!</p>
<p>注意，如果你为相同目标主机请求具有不同的配置连接池，那么你将获得 <em>独立的</em> 连接池。 这意味着，你的应用程序打开到目标端点的并发 HTTP 连接可能比任何单个连接池的 <code>max-connections</code> 设置允许的更多。</p>
<p>There is one setting that likely deserves a bit deeper explanation: <code>max-open-requests</code>. This setting limits the maximum number of requests that can be in-flight at any time for a single connection pool. If an application calls <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> 3 times (with the same endpoint and settings) it will get back <code>3</code> different client flow instances for the same pool. If each of these client flows is then materialized <code>4</code> times (concurrently) the application will have 12 concurrently running client flow materializations. All of these share the resources of the single pool.</p>
<p>有一个设置可能值得深入解释：<code>max-open-requests</code>。此设置限制单个连接池在任何时间可以运行的最大请求数量。 如果应用程序调用 <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> 3次 （使用相同端点和设置），对于相同连接池它将取回 <code>3</code> 个不同的客户端 flow 实例。如果这些客户端 flow 每一个都被具体化 <code>4</code> 次（并发）， 应用程序将有 12 个并发运行的客户端 flow 物化值。所有这些（flow、连接等）都共享单个池的资源。</p>
<p>This means that no more than 12 requests can be open at any time.</p>
<p>这意味着任何时候都不可能打开多于 12 个请求。</p>
<p>The <code>max-open-requests</code> config setting allows for applying a hard limit which serves mainly as a protection against erroneous connection pool use, e.g. because the application is materializing too many client flows that all compete for the same pooled connections.</p>
<p><code>max-open-requests</code> 配置设置允许应用硬限制，该限制主要是为了防止错误的连接池使用，例如：因为应用程序实现了太多的客户端 flow，导致它们都在争用相同的连接池。</p>
<a id="using-a-host-connection-pool"></a>
<h2><a href="#using-a-host-connection-pool" name="using-a-host-connection-pool" class="anchor"><span class="anchor-link"></span></a>Using a Host Connection Pool</h2>
<p><strong>使用主机连接池</strong></p>
<p>The &ldquo;pool client flow&rdquo; returned by <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> has the following type:</p>
<p>通过 <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> 返回的“池客户端 flow”具有下面的类型： </p><div class="group-scala">
<pre class="prettyprint"><code class="language-scala">Flow[(HttpRequest, T), (Try[HttpResponse], T), HostConnectionPool]
</code></pre></div><div class="group-java">
<pre class="prettyprint"><code class="language-java">Flow&lt;Pair&lt;HttpRequest, T&gt;, Pair&lt;Try&lt;HttpResponse&gt;, T&gt;, HostConnectionPool&gt;
</code></pre></div>
<p>This means it consumes pairs of type <span class="group-scala"><code>(HttpRequest, T)</code></span><span class="group-java"><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/japi/Pair.html" title="akka.japi.Pair"><code>Pair[HttpRequest, T]</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/japi/Pair.html" title="akka.japi.Pair"><code>Pair&lt;HttpRequest, T&gt;</code></a></span></span> and produces pairs of type <span class="group-scala"><code>(Try[HttpResponse], T)</code></span><span class="group-java"><code>Pair&lt;Try&lt;HttpResponse&gt;, T&gt;</code></span> which might appear more complicated than necessary on first sight. The reason why the pool API includes objects of custom type <code>T</code> on both ends lies in the fact that the underlying transport usually comprises more than a single connection and as such the pool client flow often generates responses in an order that doesn&rsquo;t directly match the consumed requests. We could have built the pool logic in a way that reorders responses according to their requests before dispatching them to the application, but this would have meant that a single slow response could block the delivery of potentially many responses that would otherwise be ready for consumption by the application.</p>
<p>这意味着它消费 <span class="group-scala"><code>(HttpRequest, T)</code></span><span class="group-java"><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/japi/Pair.html" title="akka.japi.Pair"><code>Pair[HttpRequest, T]</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/japi/Pair.html" title="akka.japi.Pair"><code>Pair&lt;HttpRequest, T&gt;</code></a></span></span> 类型的元组并且产生 <span class="group-scala"><code>(Try[HttpResponse], T)</code></span><span class="group-java"><code>Pair&lt;Try&lt;HttpResponse&gt;, T&gt;</code></span>　类型的元组，该类型第一眼看上去可能比较复杂。 池 API 在两端都包含自定义类型 <code>T</code> 的原因是，事实上底层传输通常包含多个连接，此类池客户端 flow 通常按所用请求不直接匹配的顺序生成响应。 我们本来可以用响应发送到应用程序之前根据它们的请求重新排序响应的方式来构建池逻辑，但是这将意味着单个慢速响应可能阻止潜在的多个响应的传递， 否则这些响应准备好被应用程序消费。 </p>
<p>In order to prevent unnecessary head-of-line blocking the pool client-flow is allowed to dispatch responses as soon as they arrive, independently of the request order. Of course this means that there needs to be another way to associate a response with its respective request. The way that this is done is by allowing the application to pass along a custom &ldquo;context&rdquo; object with the request, which is then passed back to the application with the respective response. This context object of type <code>T</code> is completely opaque to Akka HTTP, i.e. you can pick whatever works best for your particular application scenario.</p>
<p>为了防止不必要的行首（head-of-line）阻塞，池客户端-flow 被允许在响应到达时方式立刻分发它们，与请求顺序无关。 这样做的方式是允许应用程序随请求传递一个自定义“上下文”对象，然后以相应的响应将其传递回应用程序。 <code>T</code> 类型的上下文对象对 Akka HTTP 完全不透明，例如：你可以选择最适合你的特定应用程序的场景。</p><div class="callout note "><div class="callout-title">Note</div>
<p>A consequence of using a pool is that long-running requests block a connection while running and may starve other requests. Make sure not to use a connection pool for long-running requests like long-polling GET requests. Use the <a href="connection-level.html">Connection-Level Client-Side API</a> instead.</p>
<p>使用池的一种结果是长时间运行的请求在运行时阻塞连接，并可能饿死其它请求。确保对于长时间运行的请求不要使用连接池，例如长轮询 GET 请求。 使用 <a href="connection-level.html">连接级别客户端 API</a> 替代。</p></div>
<h2><a href="#连接分配逻辑" name="连接分配逻辑" class="anchor"><span class="anchor-link"></span></a>连接分配逻辑</h2>
<p><strong>Connection Allocation Logic</strong></p>
<p>This is how Akka HTTP allocates incoming requests to the available connection &ldquo;slots&rdquo;:</p>
<ol>
  <li>If there is a connection alive and currently idle then schedule the request across this connection.</li>
  <li>If no connection is idle and there is still an unconnected slot then establish a new connection.</li>
  <li>If all connections are already established and &ldquo;loaded&rdquo; with other requests then pick the connection with the least open requests that only has requests with idempotent methods scheduled to it, if there is one.</li>
  <li>Otherwise apply back-pressure to the request source, i.e. stop accepting new requests.</li>
</ol>
<p>这是 Akka HTTP 如何分配传入请求到可用连接“插槽”：</p>
<ol>
  <li>如果有一个连接处于活动状态并且当前处于空闲状态，那么就在这个连接上调度请求。</li>
  <li>如果没有连接空闲并且仍有一个未连接的插槽，那么建立一个新连接。</li>
  <li>如果所有连接都已经建立并且“加载”了其它请求，那么选择打开请求数最少的连接，这些请求只有调度了幂等方法的请求（如果有的话）。</li>
  <li>否则，对请求源施加回压，例如：停止接受新的请求。</li>
</ol>
<h2><a href="#retrying-a-request" name="retrying-a-request" class="anchor"><span class="anchor-link"></span></a>Retrying a Request</h2>
<p><strong>重试请求</strong></p>
<p>If the <code>max-retries</code> pool config setting is greater than zero the pool retries idempotent requests for which a response could not be successfully retrieved. Idempotent requests are those whose HTTP method is defined to be idempotent by the HTTP spec, which are all the ones currently modelled by Akka HTTP except for the <code>POST</code>, <code>PATCH</code> and <code>CONNECT</code> methods.</p>
<p>如果 <code>max-retries</code> 池配置设置大于零，池将重试无法成功检索到响应的幂等请求。幂等请求是那些HTTP 方法被 HTTP 规范定义为幂等的的请求， 这些请求当前都由 Akka HTTP 建模的，除了 <code>POST</code>、<code>PATCH</code> 和 <code>CONNECT</code> 方法。</p>
<p>When a response could not be received for a certain request there are essentially three possible error scenarios:</p>
<ol>
  <li>The request got lost on the way to the server.</li>
  <li>The server experiences a problem while processing the request.</li>
  <li>The response from the server got lost on the way back.</li>
</ol>
<p>当不能收到某个请求的响应时，基本上有三种可能的错误场景：</p>
<ol>
  <li>请求在去服务器的路上丢失。</li>
  <li>服务器在处理请求时遇到问题。</li>
  <li>响应从服务器返回的路上丢失。</li>
</ol>
<p>Since the host connector cannot know which one of these possible reasons caused the problem and therefore <code>PATCH</code> and <code>POST</code> requests could have already triggered a non-idempotent action on the server these requests cannot be retried.</p>
<p>由于主机连接器不知道是哪种可能原因导致的问题，因此 <code>PATCH</code> 和 <code>POST</code> 请求在服务器上可能已经触发了非幂等动作，所以不能重试这些请求。</p>
<p>In these cases, as well as when all retries have not yielded a proper response, the pool produces a failed <code>Try</code> (i.e. a <code>scala.util.Failure</code>) together with the custom request context.</p>
<p>在这些情况下，以及当所有重试都不能产生正确响应时，池将生成一个失败 <code>Try</code>（既：<code>scala.util.Failure</code>）和自定义请求上下文。</p>
<p>If a request fails during connecting to the server, for example, because the DNS name cannot be resolved or the server is currently unavailable, retries are attempted with exponential backoff delay. See the documentation of the <code>akka.http.host-connection-pool.base-connection-backoff</code> setting in the <a href="../configuration.html">configuration</a>.</p>
<p>如果在连接到服务器期间请求失败，例如，因为不能解析 DNS 名称或者服务器当前不可达，尝试以指数回退延迟重试。 见 <a href="../configuration.html">配置</a> 里 <code>akka.http.host-connection-pool.base-connection-backoff</code> 设置的文档。</p>
<h2><a href="#pool-shutdown" name="pool-shutdown" class="anchor"><span class="anchor-link"></span></a>Pool Shutdown</h2>
<p><strong>池关闭</strong></p>
<p>Completing a pool client flow will simply detach the flow from the pool. The connection pool itself will continue to run as it may be serving other client flows concurrently or in the future. Only after the configured <code>idle-timeout</code> for the pool has expired will Akka HTTP automatically terminate the pool and free all its resources.</p>
<p>完成的池客户端 flow 将从池简单地分离 flow。连接池自身将继续运行，因为它可能同时或在将来服务其它客户端 flow。 只有在池配置的 <code>idle-timeout</code> 过期以后，Akka HTTP 才将自动终止池并释放其所有资源。</p>
<p>If a new client flow is requested with <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> or if an already existing client flow is re-materialized the respective pool is automatically and transparently restarted.</p>
<p>如果使用 <span class="group-scala"><code>Http().cachedHostConnectionPool(...)</code></span><span class="group-java"><code>Http.get(system).cachedHostConnectionPool(...)</code></span> 请求一个新的客户端 flow 或者 一个已存在的客户端 flow 重新具体化，则自动并透明的重启相应池。</p>
<p>In addition to the automatic shutdown via the configured idle timeouts it&rsquo;s also possible to trigger the immediate shutdown of a specific pool by calling <code>shutdown()</code> on the <code>HostConnectionPool</code> instance that the pool client flow materializes into. This <code>shutdown()</code> call produces a <span class="group-scala"><code>Future[Unit]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> which is fulfilled when the pool termination has been completed.</p>
<p>除了通过配置的空闲超时自动关闭以外，还可以调用池客户端 flow 具体化到的 <code>HostConnectionPool</code> 实例上的 <code>shutdown()</code> 方法来触发特定池的立即关闭。 <code>shutdown()</code> 调用产生一个 <span class="group-scala"><code>Future[Unit]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> ，当池终止完成时 <span class="group-scala"><code>Future[Unit]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> 也完成。</p>
<p>It&rsquo;s also possible to trigger the immediate termination of <em>all</em> connection pools in the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span> at the same time by calling <span class="group-scala"><code>Http().shutdownAllConnectionPools()</code></span><span class="group-java"><code>Http.get(system).shutdownAllConnectionPools()</code></span>. This call too produces a <span class="group-scala"><code>Future[Unit]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> which is fulfilled when all pools have terminated.</p>
<p>还可以调用 <span class="group-scala"><code>Http().shutdownAllConnectionPools()</code></span><span class="group-java"><code>Http.get(system).shutdownAllConnectionPools()</code></span> 同时触发 <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span> 里的 <em>所有</em> 连接池立即终止。 该调用产生一个 <span class="group-scala"><code>Future[Unit]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> ，当池终止完成时 <span class="group-scala"><code>Future[Unit]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> 也完成。</p><div class="callout note "><div class="callout-title">Note</div>
<p>When encountering unexpected <code>akka.stream.AbruptTerminationException</code> exceptions during <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span> <strong>shutdown</strong> please make sure that active connections are shut down before shutting down the entire system, this can be done by calling the <span class="group-scala"><code>Http().shutdownAllConnectionPools()</code></span><span class="group-java"><code>Http.get(system).shutdownAllConnectionPools()</code></span> method, and only once its <span class="group-scala"><code>Future</code></span><span class="group-java"><code>CompletionStage</code></span> completes, shutting down the actor system.</p>
<p>当在 <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span> <strong>关闭</strong> 期间遇到意外的 <code>akka.stream.AbruptTerminationException</code> 异常时， 请确保在关闭整个系统之前关闭活动连接，这可以通过调用 <span class="group-scala"><code>Http().shutdownAllConnectionPools()</code></span><span class="group-java"><code>Http.get(system).shutdownAllConnectionPools()</code></span> 方法来完成，并且只在 <span class="group-scala"><code>Future</code></span><span class="group-java"><code>CompletionStage</code></span> 完成后，再关闭 actor 系统。</p></div>
<h2><a href="#examples" name="examples" class="anchor"><span class="anchor-link"></span></a>Examples</h2>
<p><strong>示例</strong></p><div class="callout note group-scala"><div class="callout-title">Note</div>
<p>At this place we previously showed an example that used the <code>Source.single(request).via(pool).runWith(Sink.head)</code>. In fact, this is an anti-pattern that doesn&rsquo;t perform well. Please either supply requests using a queue or in a streamed fashion as shown below.</p>
<p>在这个地方，我们之前展示了一个使用 <code>Source.single(request).via(pool).runWith(Sink.head)</code> 的例子。事实上，这是一种表现不好的反模式。 请使用队列或流的方式提供请求，如下所示。</p></div><div class="group-scala">
<h3><a href="#using-the-host-level-api-with-a-queue" name="using-the-host-level-api-with-a-queue" class="anchor"><span class="anchor-link"></span></a>Using the host-level API with a queue</h3>
<p><strong>使用带有队列的主机级别 API</strong></p>
<p>In many cases, you just want to issue requests to a pool and receive responses when they are available. In most cases, you should use the <a href="request-level.html">Request-Level Client-Side API</a> for this purpose. If you want to use a similar Future-based API with the host-level API, here&rsquo;s how to do it.</p>
<p>在许多情况下，你只想向池发出请求，并在可用时接收响应。大多情况下，为此目的你应使用 <a href="request-level.html">请求级别客户端 API</a> 。 如果你想将类似基于 Future 的 API 与主机级别 API 一起使用，这里是它们如何做到的说明。</p>
<p>As explained above, Akka HTTP prevents to build up an unbounded buffer of requests and an unlimited number of connections. Therefore, it guards itself a) by applying backpressure to all request streams connected to the cached pool and b) by failing requests with a <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/stream/BufferOverflowException.html" title="akka.stream.BufferOverflowException"><code>BufferOverflowException</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/stream/BufferOverflowException.html" title="akka.stream.BufferOverflowException"><code>BufferOverflowException</code></a></span> when the internal buffer overflows when too many materializations exist or too many requests have been issued to the pool.</p>
<p>如上面所述，Akka HTTP 防止构建无界缓冲请求和无限制数量的连接。因此，它保护自己 a) 对连接到缓存池的所有请求流施加回压， b) 当内部缓冲溢出、当存在太多具体化值 <em>(译注：指池客户端-flow)</em> 或者向池发出太多请求时，使用 <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/stream/BufferOverflowException.html" title="akka.stream.BufferOverflowException"><code>BufferOverflowException</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/stream/BufferOverflowException.html" title="akka.stream.BufferOverflowException"><code>BufferOverflowException</code></a></span> 让请求失败。</p>
<p>To mimic the request-level API we can put an explicit queue in front of the pool and decide ourselves what to do when this explicit queue overflows. This example shows how to do this. (Thanks go to <a href="https://kazuhiro.github.io/scala/akka/akka-http/akka-streams/2016/01/31/connection-pooling-with-akka-http-and-source-queue.html">kazuhiro&rsquo;s blog for the initial idea</a>.)</p>
<p>要模仿请求级别 API，我们可以在池的前面放置一个显示队列，并且当这个显示队列溢出时我们自己决定要做什么。这个例子显示这是如何做的。 （谢谢 <a href="https://kazuhiro.github.io/scala/akka/akka-http/akka-streams/2016/01/31/connection-pooling-with-akka-http-and-source-queue.html">有关最被想法的 kazuhiro 的博客</a>）。</p>
<p>You can tweak the <code>QueueSize</code> setting according to your memory constraints. In any case, you need to think about a strategy about what to do when requests fail because the queue overflowed (e.g. try again later or just fail).</p>
<p>你可以根据内存限制调整 <code>QueueSize</code> 设置。在任何情况下，你需要思考一个策略，既当因为队列溢出而请求失败时（例如：稍候重试或只是失败）。 </p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/akka-http/tree/zh-docs-10.1/docs-zh/src/test/scala/docs/http/scaladsl/HttpClientExampleSpec.scala#L215-L254" target="_blank" title="Go to snippet source"></a><code class="language-scala">import scala.util.{ Failure, Success }
import scala.concurrent.{ Future, Promise }

import akka.actor.ActorSystem
import akka.http.scaladsl.Http
import akka.http.scaladsl.model._
import akka.stream.ActorMaterializer
import akka.stream.scaladsl._

import akka.stream.{ OverflowStrategy, QueueOfferResult }

implicit val system = ActorSystem()
import system.dispatcher // to get an implicit ExecutionContext into scope
implicit val materializer = ActorMaterializer()

val QueueSize = 10

// This idea came initially from this blog post:
// http://kazuhiro.github.io/scala/akka/akka-http/akka-streams/2016/01/31/connection-pooling-with-akka-http-and-source-queue.html
val poolClientFlow = Http().cachedHostConnectionPool[Promise[HttpResponse]](&quot;akka.io&quot;)
val queue =
  Source.queue[(HttpRequest, Promise[HttpResponse])](QueueSize, OverflowStrategy.dropNew)
    .via(poolClientFlow)
    .to(Sink.foreach({
      case ((Success(resp), p)) =&gt; p.success(resp)
      case ((Failure(e), p))    =&gt; p.failure(e)
    }))
    .run()

def queueRequest(request: HttpRequest): Future[HttpResponse] = {
  val responsePromise = Promise[HttpResponse]()
  queue.offer(request -&gt; responsePromise).flatMap {
    case QueueOfferResult.Enqueued    =&gt; responsePromise.future
    case QueueOfferResult.Dropped     =&gt; Future.failed(new RuntimeException(&quot;Queue overflowed. Try again later.&quot;))
    case QueueOfferResult.Failure(ex) =&gt; Future.failed(ex)
    case QueueOfferResult.QueueClosed =&gt; Future.failed(new RuntimeException(&quot;Queue was closed (pool shut down) while running the request. Try again later.&quot;))
  }
}

val responseFuture: Future[HttpResponse] = queueRequest(HttpRequest(uri = &quot;/&quot;))</code></pre>
<h3><a href="#using-the-host-level-api-in-a-streaming-fashion" name="using-the-host-level-api-in-a-streaming-fashion" class="anchor"><span class="anchor-link"></span></a>Using the host-level API in a streaming fashion</h3>
<p><strong>以流方式使用主机级别 API</strong></p>
<p>Even better is it to use the streaming API directly. This will mostly prevent intermediate buffers as data can be generated &ldquo;on-the-fly&rdquo; while streaming the requests. You supply the requests as a stream, i.e. as a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/stream/javadsl/Source.html" title="akka.stream.javadsl.Source"><code>Source&lt;(HttpRequest, ...)&gt;</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/stream/scaladsl/Source.html" title="akka.stream.scaladsl.Source"><code>Source[(HttpRequest, ...)]</code></a></span>, and the pool will &ldquo;pull out&rdquo; single requests when capacity is available on one of the connections to the host.</p>
<p>直接使用流式 API 甚至更好。这将主要防止中间缓冲区，因为数据可以在流请求时“动态”生成。以流的形式提供抗日请求，例如：作为 <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.26/?akka/stream/javadsl/Source.html" title="akka.stream.javadsl.Source"><code>Source&lt;(HttpRequest, ...)&gt;</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.26/akka/stream/scaladsl/Source.html" title="akka.stream.scaladsl.Source"><code>Source[(HttpRequest, ...)]</code></a></span> ， 当到主机的连接上容量可用时，池将“拉出”单个请求。</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/akka-http/tree/zh-docs-10.1/docs-zh/src/test/scala/docs/http/scaladsl/HttpClientExampleSpec.scala#L260-L322" target="_blank" title="Go to snippet source"></a><code class="language-scala">import java.nio.file.{ Path, Paths }

import scala.util.{ Failure, Success }
import scala.concurrent.Future

import akka.NotUsed
import akka.actor.ActorSystem
import akka.http.scaladsl.Http
import akka.http.scaladsl.model._
import akka.stream.ActorMaterializer
import akka.stream.scaladsl._

import akka.http.scaladsl.model.Multipart.FormData
import akka.http.scaladsl.marshalling.Marshal

implicit val system = ActorSystem()
import system.dispatcher // to get an implicit ExecutionContext into scope
implicit val materializer = ActorMaterializer()

case class FileToUpload(name: String, location: Path)

def filesToUpload(): Source[FileToUpload, NotUsed] =
  // This could even be a lazy/infinite stream. For this example we have a finite one:
  Source(List(
    FileToUpload(&quot;foo.txt&quot;, Paths.get(&quot;./foo.txt&quot;)),
    FileToUpload(&quot;bar.txt&quot;, Paths.get(&quot;./bar.txt&quot;)),
    FileToUpload(&quot;baz.txt&quot;, Paths.get(&quot;./baz.txt&quot;))
  ))

val poolClientFlow =
  Http().cachedHostConnectionPool[FileToUpload](&quot;akka.io&quot;)

def createUploadRequest(fileToUpload: FileToUpload): Future[(HttpRequest, FileToUpload)] = {
  val bodyPart =
    // fromPath will use FileIO.fromPath to stream the data from the file directly
    FormData.BodyPart.fromPath(fileToUpload.name, ContentTypes.`application/octet-stream`, fileToUpload.location)

  val body = FormData(bodyPart) // only one file per upload
  Marshal(body).to[RequestEntity].map { entity =&gt; // use marshalling to create multipart/formdata entity
    // build the request and annotate it with the original metadata
    HttpRequest(method = HttpMethods.POST, uri = &quot;http://example.com/uploader&quot;, entity = entity) -&gt; fileToUpload
  }
}

// you need to supply the list of files to upload as a Source[...]
filesToUpload()
  // The stream will &quot;pull out&quot; these requests when capacity is available.
  // When that is the case we create one request concurrently
  // (the pipeline will still allow multiple requests running at the same time)
  .mapAsync(1)(createUploadRequest)
  // then dispatch the request to the connection pool
  .via(poolClientFlow)
  // report each response
  // Note: responses will not come in in the same order as requests. The requests will be run on one of the
  // multiple pooled connections and may thus &quot;overtake&quot; each other.
  .runForeach {
    case (Success(response), fileToUpload) =&gt;
      // TODO: also check for response status code
      println(s&quot;Result for file: $fileToUpload was successful: $response&quot;)
      response.discardEntityBytes() // don&#39;t forget this
    case (Failure(ex), fileToUpload) =&gt;
      println(s&quot;Uploading file $fileToUpload failed with $ex&quot;)
  }</code></pre></div><div class="group-java">
<p>For now, please see the Scala examples in <a href="../client-side/host-level.html#examples?language=scala">Scala Host-Level Client API</a>. If you want to help with converting the examples see issue <a href="https://github.com/akka/akka-http/issues/836">#836</a>.</p>
<p>现在，请见 <a href="../client-side/host-level.html#examples?language=scala">主机级别客户端 API</a> 里的 Scala 例子。 如果你想帮忙转换例子到 Java，见问题 <a href="https://github.com/akka/akka-http/issues/836">#836</a> 。</p></div>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../client-side/request-level.html"><i class="icon-prev"></i> <span class="link-prev">请求级别客户端 API</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../client-side/connection-level.html">连接级别客户端 API <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
在此文档中发现错误？该页面的源代码可以在 <a href="https://github.com/yangbajing/akka-http/tree/zh-docs-10.1/docs-zh/src/main/paradox/client-side/host-level.md" target="_blank">这里</a> 找到。欢迎随时编辑并提交 Pull Request。
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka HTTP 10.1.11 Chinese edition is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>


</body>
</html>
